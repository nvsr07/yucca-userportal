
<div ng-controller="TenantCtrl as tenantCtrl">
	<div class="alert alert-danger text-left" ng-show='errors.length>0'>
		<strong translate>ERROR</strong>
		<ul><li ng-repeat="error in errors"><span translate>{{error}}</span></li></ul>
	</div>
	<div class="alert alert-warning text-left" ng-show='warnings.length>0'>
		<strong translate>WARNING</strong>
		<ul><li ng-repeat="warning in warnings"><span translate>{{warning}}</span></li></ul>
	</div>
	<div class="alert alert-info text-left" ng-show='infos.length>0'>
		<strong translate>INFO</strong>
		<ul><li ng-repeat="info in infos "><span translate>{{info}}</span></li></ul>
	</div>
	<div class='' ng-cloak>
		<div class='clearfix  content-toolbar'>	
			<div class="btn-group pull-left">
				<a class='btn btn-default ' href ng-click="openNewTenant()"><span translate>DASHBOARD_TENANT_NEW_BUTTON</span></a>
			</div>
			<div class="btn-group pull-right">
				<form class="form-inline" role="form">
					<div class="form-group">
						<input type="text" class="form-control input-sm" ng-model="statusFilter" placeholder="{{'TENANT_LIST_STATUS_FILTER'|translate}}" />
					</div>
					<div class="form-group">
						<input type="text" class="form-control input-sm" ng-model="nameFilter" placeholder="{{'TENANT_LIST_NAME_FILTER'|translate}}" />
					</div>
					<div class="form-group">
						<input type="text" class="form-control input-sm" ng-model="codeFilter" placeholder="{{'TENANT_LIST_CODE_FILTER'|translate}}" />
					</div>
				</form>
			</div>
		</div>
		<div class="table-responsive dashboard-tenantList-table">
			<table class="table table-actions">
				<thead>
					<tr>
						<th>
							<input type="checkbox" name="selectAll"  ng-click="selectAll($event)"  />
						</th>
						<th>
							<a href="" ng-click="predicate = 'tenant.idTenant'; reverse=!reverse"><span translate>TENANT_FIELD_ID</span> 
								<span ng-show="predicate=='tenant.idTenant' && !reverse" class="glyphicon glyphicon-chevron-up small"></span>
								<span ng-show="predicate=='tenant.idTenant' && reverse" class="glyphicon glyphicon-chevron-down small"></span>
							</a>
						</th>
						<th>
							<a href="" ng-click="predicate = 'tenant.tenantName'; reverse=!reverse"><span translate>TENANT_FIELD_NAME</span> 
							<span ng-show="predicate=='tenant.tenantName' && !reverse" class="glyphicon glyphicon-chevron-up small"></span>
							<span ng-show="predicate=='tenant.tenantName' && reverse" class="glyphicon glyphicon-chevron-down small"></span></a>
						</th>
						<th>
							<a href="" ng-click="predicate = 'tenant.tenantCode'; reverse=!reverse"><span translate>TENANT_FIELD_CODE</span> 
							<span ng-show="predicate=='tenant.tenantCode' && !reverse" class="glyphicon glyphicon-chevron-up small"></span>
							<span ng-show="predicate=='tenant.tenantCode' && reverse" class="glyphicon glyphicon-chevron-down small"></span></a>
						
						</th>
						<th>
							<a href="" ng-click="predicate = 'tenant.tenantDescription'; reverse=!reverse"><span translate>TENANT_FIELD_DESCRIPTION</span> 
							<span ng-show="predicate=='tenant.tenantDescription' && !reverse" class="glyphicon glyphicon-chevron-up small"></span>
							<span ng-show="predicate=='tenant.tenantDescription' && reverse" class="glyphicon glyphicon-chevron-down small"></span></a>
						
						</th>
						<th>
							<span translate>TENANT_FIELD_MAX_DATASET_NUM</span> 
						</th>
						<th>
							<span translate>TENANT_FIELD_MAX_STREAM_NUM</span> 
						</th>
						<th>
							<a href="" ng-click="predicate = 'stream.codDeploymentStatus'; reverse=!reverse"><span translate>STREAM_FIELD_STATUS</span> 
							<span ng-show="predicate=='stream.codDeploymentStatus' && !reverse" class="glyphicon glyphicon-chevron-up small"></span>
							<span ng-show="predicate=='stream.codDeploymentStatus' && reverse" class="glyphicon glyphicon-chevron-down small"></span></a>
						</th>
						<th>
							&nbsp;
						</th>

					</tr>
				</thead>
				<tbody>
					<tr ng-show="showLoading">
						<td colspan='10' >
							<div class='ajax-loading-container'>
								<span class='ajax-loading-big'></span>
								<h4>Loading...</h4>
							</div>
						</td>
					</tr>
					<tr  class='table-data-row' ng-class='{"table-action-selected-row": row.isSelected}' 
						ng-repeat-start="row in filteredTenants = (tenantsList | filter: searchCodeFilter | filter: searchNameFilter | filter: searchStatusFilter | orderBy:predicate:reverse )|startFrom:(currentPage-1)*pageSize | limitTo:pageSize  ">
						<td class='table-data-row-first'><input type="checkbox" ng-model="row.isSelected" ng-click="updateSelection($event, row.rowIndex)" /> 
						<td class='text-left'>
							<strong>{{row.tenant.idTenant}}</strong>
						</td>
						<td><small>{{row.tenant.tenantName}}</small></td>
						<td><small>{{row.tenant.tenantCode}}</small></td>
						<td><span title='{{row.tenant.tenantDescription}}'><small>{{row.tenant.tenantDescription|string_ellipse:15}}</small></span></td>
						<td><small>{{row.tenant.maxDatasetNum}}</small></td>
						<td><small>{{row.tenant.maxStreamsNum}}</small></td>
						<td class='text-left'><span ng-bind-html="row.statusIcon"></span> <small>{{row.codDeploymentStatusTranslated}}</small></td>
						<td class='text-right'> 
							<a class='btn btn-default btn-sm' href ng-click='openLog(row)' title="{{'DASHBOARD_STREAM_LOG_BUTTON_HINT'|translate}}"><span translate>DASHBOARD_STREAM_LOG_BUTTON</span></a>
						</td>
					</tr>
					<tr ng-repeat-end class='table-action-row table-action-selected-row' ng-show="row.isSelected || row.updated">
						<td class='table-action-row-first'>&nbsp;</td>
						<td colspan='3'>
							<form class="form-inline install-form-inline">
  								<div class="form-group">
   									<label for="streamAction"><small><span translate>DASHBOARD_STREAM_ACTION_LABEL</span></small></label>&nbsp;
   									<select class="form-control input-sm"  ng-model="row.action" ng-options="action as action for action in actions"></select>
  								</div>
		  						<div class="form-group">
	  								<span translate>DASHBOARD_STREAM_STEP_LABEL</span></div>&nbsp;
   									<label for="stepStart"><small><span translate>DASHBOARD_STREAM_START_STEP_LABEL</span></small></label>&nbsp;
   									<input type="number" class="form-control input-sm input-step" ng-model="row.startStep"/>
  								</div>
  								<div class="form-group">
   									<label for="stepEnd"><small><span translate>DASHBOARD_STREAM_END_STEP_LABEL</span></small></label>&nbsp;
   									<input type="number" class="form-control input-sm input-step" ng-model="row.endStep"/>
  								</div>
							</form>	
						</div>
						<td colspan='6'>
							<div class='install-feedback-inline'>
								<div ng-show='row.errorValidation!=null'>
									<span class="text-danger">{{row.errorValidation|translate}}</span>
								</div>
								
								
								<div ng-show='row.actionFeedback!=null'>
									<div class='clearfix install-feedback-info'>
										<div class='pull-left' ng-show='row.actionFeedback!=null'><i class="{{row.actionIconClass}}" title="{{row.actionFeedback}}"></i>&nbsp; {{row.actionFeedback}}</div>
										<div class='pull-right'>Step <strong>{{row.feedback.lastStep.actionType}}</strong> - status: <strong>{{row.feedback.lastStep.status}}</strong></div>
									</div>
									<div class='install-progress-panel'>
										<a href ng-repeat="step in row.feedback.steps" title="{{step.actionName}} - {{step.actionType}}" ng-class='step.style' style="{{step.width}}">
											{{step.stepNum}}
										</a>
									</div>
								</div>
							</div>
						</td>
					</tr>				
					
				</tbody>
			</table>
			<div class='clearfix'>
				<div class='pull-left'>
					<pagination boundary-links="true" total-items="filteredTenants.length" ng-model="currentPage" ng-change="selectPage()" class="pagination-sm" previous-text="&lsaquo;"
						next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
					></pagination>
				</div>
				<div class='pull-right'>
					<a class='btn btn-default ' href ng-click="execActions()"><span translate>DASHBOARD_STREAMS_EXEC_BUTTON</span></a>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/ng-template" id="streamInstalLog.html">
        <div class="modal-header">
            <h3 class="modal-title">Installation log <small>{{streamName}}</small> </h3>
        </div>
        <div class="modal-body">
			<div class='clearfix'>
				<div class='pull-left'>
					<form class="form-inline">
  						<div class="form-group">
   							<label for="streamAction"><span translate>DASHBOARD_STREAM_ACTION_LABEL</span></label>&nbsp;
   							<select class="form-control "  ng-model="logAction" ng-options="action as action for action in actions" ng-change="showLog(logAction)"></select>
  						</div>
						<button class="btn btn-default" ng-click="showLog(logAction)" ng-enabled='logAction!=null && logAction!=""'>Open</button>
					</form>
				</div>	
				<div class='pull-right'><a ng-href="{{extendedLogUrl}}" target='_blank' ng-show='logAction!=null && logAction!=""'>Show log in a new window</a></div>
			</div>
			<div class="alert alert-danger text-left" ng-show='error!=null'>
				<strong translate>ERROR</strong> 
				<p><span ng-bind-html="error"></span></p>
			</div>
			<div class='ajax-loading-container' ng-show="showLoading">
				<span class='ajax-loading-big'></span>
				<h4>Loading...</h4>
			</div>
			<div class='dashboard-log-panel-container'>
				<div class='dashboard-log-panel' ng-show='extendedLog!=null'>
					 <p ng-bind-html="extendedLog"></p>
				</div>
			</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="close()">OK</button>
        </div>
    </script>

	<script type="text/ng-template" id="newTenant.html">
        <div class="modal-header">
			<button type="button" class="close" ng-click="close()" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h3 class="modal-title">New Tenant</small></h3>
        </div>
        <div class="modal-body dashboard-tenant-new-tenant-dialog">
			<div class="alert alert-success text-left" ng-show='info!=null'>
				<strong translate>INFO</strong> 
				<p><span ng-bind-html="info"></span></p>
			</div>
			<div class="alert alert-danger text-left" ng-show='error!=null'>
				<strong translate>ERROR</strong> 
				<p><span ng-bind-html="error"></span></p>
			</div>
			<div class="alert alert-warning text-left" ng-show='warning!=null'>
				<strong translate>WARNING</strong> 
				<p><span ng-bind-html="warning"></span></p>
			</div>
			 <form class='form-horizontal' role="form" name="forms.newTenantForm">
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_NAME</strong> *</div>
					<div class='col-sm-9'><input type='text' class="form-control " ng-model="newTenant.tenantName" ng-required="true" /></div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_CODE</strong> *</div>
					<div class='col-sm-9'><input type='text' class="form-control " ng-model="newTenant.tenantCode" ng-required="true"/></div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_PASSWORD</strong> *</div>
					<div class='col-sm-9'><input type='text' class="form-control " ng-model="newTenant.tenantPassword" ng-required="true"/></div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_DESCRIPTION</strong></div>
					<div class='col-sm-9'><input type='text' class="form-control " ng-model="newTenant.tenantDescription"/></div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_ECOSYSTEM_ID</strong></div>
					<div class='col-sm-9'>
   						<select class="form-control input-sm"  ng-model="newTenant.idEcosystem" ng-options="ecosystem.idEcosystem as ecosystem.ecosystemName for ecosystem in ecosystemList"></select>
					</div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_TYPE</strong></div>
					<div class='col-sm-9'>
						<select class="form-control " ng-model="newTenant.tenantType">
							<option value='default'>default</option>
							<option value='trial'>trial</option>
						</select>
					</div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_MAX_DATASET_NUM</strong></div>
					<div class='col-sm-9'><input type='number' class="form-control " ng-model="newTenant.maxDatasetNum"/></div>
				</div>
				<div class='form-group'>
					<div class='col-sm-3 col-offset-sm-1'><strong translate>TENANT_FIELD_MAX_STREAM_NUM</strong></div>
					<div class='col-sm-9'><input type='number' class="form-control " ng-model="newTenant.maxStreamsNum"/></div>
				</div>
				<div class='form-group'><div class='col-sm-12'>&nbsp;</div></div>
				<div class='form-group'>
					<div class='col-sm-12 text-right'>
						<button class="btn btn-default " ng-click="createNewTenant()"  g-disabled="forms.newTenantForm.$invalid ">Create</button>
					</div>
				</div>
			</form>	
        </div>
    </script>
</div>